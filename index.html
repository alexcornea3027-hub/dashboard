<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VCB Performance Tracker | Elite</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');

        :root {
            --bg: #030712;
            --card: rgba(30, 41, 59, 0.7);
            --border: rgba(255, 255, 255, 0.1);
            --cyan: #22d3ee;
            --green: #4ade80;
            --rose: #fb7185;
            --text: #f8fafc;
            --shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: radial-gradient(circle at top left, #0f172a, #030712);
            color: var(--text);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            padding: 15px;
        }

        /* --- HEADER --- */
        header {
            height: 10vh;
            display: grid;
            grid-template-columns: 1fr 1.5fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .h-panel {
            background: var(--card);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 10px 25px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            box-shadow: var(--shadow);
        }

        .target-box {
            flex-direction: row;
            justify-content: space-around;
            align-items: center;
            border-bottom: 3px solid var(--cyan);
        }

        .kpi-val { font-size: 1.8rem; font-weight: 800; color: var(--cyan); line-height: 1; }
        .kpi-lbl { font-size: 0.65rem; text-transform: uppercase; letter-spacing: 1px; opacity: 0.7; }

        /* --- DASHBOARD GRID --- */
        .main-grid {
            flex: 1;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 15px;
            min-height: 0;
        }

        .card {
            background: var(--card);
            backdrop-filter: blur(15px);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow);
        }

        .card-title {
            font-size: 0.75rem;
            font-weight: 800;
            text-transform: uppercase;
            color: var(--cyan);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .card-title::before { content:''; width:4px; height:12px; background:var(--cyan); border-radius:2px; }

        /* --- HELPERS --- */
        .chart-box { flex: 1; position: relative; min-height: 0; width: 100%; }
        
        .task-layout { display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 10px; flex: 1; min-height: 0; }
        .scroller { overflow-y: auto; padding-right: 5px; }
        .scroller::-webkit-scrollbar { width: 3px; }
        .scroller::-webkit-scrollbar-thumb { background: var(--cyan); }

        .item {
            background: rgba(255, 255, 255, 0.03);
            margin-bottom: 4px;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.75rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; box-shadow: 0 0 8px currentColor; }

        .gauge-overlay {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }
        .gauge-overlay h2 { font-size: 1.5rem; font-weight: 800; }

    </style>
</head>
<body>

    <header>
        <div class="h-panel">
            <h2 id="clock-time" style="font-size: 1.5rem;">00:00:00</h2>
            <p id="clock-date" style="color: var(--cyan); font-size: 0.8rem; font-weight: 600;"></p>
        </div>
        <div class="h-panel target-box">
            <div style="text-align:center">
                <span class="kpi-lbl">Daily Realized</span>
                <span class="kpi-val" id="kpi-total">0</span>
            </div>
            <div style="text-align:center">
                <span class="kpi-lbl">Target (1193)</span>
                <span class="kpi-val" id="kpi-delta">0</span>
            </div>
        </div>
        <div class="h-panel" style="align-items: flex-end;">
            <span class="kpi-lbl">Current Week Total</span>
            <h2 id="kpi-week" style="color: var(--green); font-size: 1.8rem;">0</h2>
        </div>
    </header>

    <main class="main-grid">
        <div class="card">
            <div class="card-title">Today's Output by Area</div>
            <div class="chart-box"><canvas id="chartDailyArea"></canvas></div>
        </div>

        <div class="card">
            <div class="card-title">Weekly Distribution by Area</div>
            <div class="chart-box"><canvas id="chartWeeklyArea"></canvas></div>
        </div>

        <div class="card">
            <div class="card-title">Weekly Productivity Trend</div>
            <div class="chart-box"><canvas id="chartTrend"></canvas></div>
        </div>

        <div class="card">
            <div class="card-title">Daily Task Compliance</div>
            <div class="task-layout">
                <div class="scroller" id="listDaily"></div>
                <div class="chart-box">
                    <canvas id="pieDaily"></canvas>
                    <div class="gauge-overlay"><h2 id="percDaily">0%</h2></div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-title">Weekly Task Compliance</div>
            <div class="task-layout">
                <div class="scroller" id="listWeekly"></div>
                <div class="chart-box">
                    <canvas id="pieWeekly"></canvas>
                    <div class="gauge-overlay"><h2 id="percWeekly">0%</h2></div>
                </div>
            </div>
        </div>

        <div class="card" style="background: linear-gradient(135deg, rgba(34, 211, 238, 0.1), transparent);">
            <div class="card-title">Performance Summary</div>
            <div style="display: flex; flex-direction: column; justify-content: space-around; flex: 1; padding: 10px 0;">
                <div style="display:flex; justify-content:space-between">
                    <span>Target Attainment:</span>
                    <b id="attainment">0%</b>
                </div>
                <div style="width:100%; height:8px; background:rgba(255,255,255,0.1); border-radius:10px; overflow:hidden;">
                    <div id="attainment-bar" style="height:100%; background:var(--cyan); width:0%"></div>
                </div>
                <div style="display:flex; justify-content:space-between">
                    <span>Task Completion:</span>
                    <b id="task-total-perc">0%</b>
                </div>
                <div style="width:100%; height:8px; background:rgba(255,255,255,0.1); border-radius:10px; overflow:hidden;">
                    <div id="task-bar" style="height:100%; background:var(--green); width:0%"></div>
                </div>
            </div>
        </div>
    </main>

    <script>
        const GOAL = 1193;

        function runClock() {
            const now = new Date();
            document.getElementById('clock-time').innerText = now.toLocaleTimeString('en-GB');
            document.getElementById('clock-date').innerText = now.toLocaleDateString('en-GB', {weekday: 'long', day: 'numeric', month: 'long'});
        }
        setInterval(runClock, 1000); runClock();

        async function init() {
            try {
                const res = await fetch('data/dashboard.json');
                const data = await res.json();
                render(data);
            } catch(e) { console.error("Data fetch error"); }
        }

        function render(data) {
            const w = data.weeklyPiData || [];
            
            // Stats & Header
            const totalDaily = w.reduce((s, x) => s + (x["Daily Qty"] || 0), 0);
            const totalWeekly = w.reduce((s, x) => s + (x["Weekly Qty"] || 0), 0);
            const delta = totalDaily - GOAL;
            
            document.getElementById('kpi-total').innerText = totalDaily.toLocaleString();
            document.getElementById('kpi-delta').innerText = (delta >= 0 ? "+" : "") + delta;
            document.getElementById('kpi-delta').style.color = delta >= 0 ? 'var(--green)' : 'var(--rose)';
            document.getElementById('kpi-week').innerText = totalWeekly.toLocaleString();

            // Attainment Bar
            const attainment = Math.min((totalDaily / GOAL) * 100, 100).toFixed(1);
            document.getElementById('attainment').innerText = attainment + "%";
            document.getElementById('attainment-bar').style.width = attainment + "%";

            // 1. Daily Bar Chart
            new Chart(document.getElementById('chartDailyArea'), {
                type: 'bar',
                data: { labels: w.map(x => x.Area), datasets: [{ data: w.map(x => x["Daily Qty"]), backgroundColor: '#22d3ee', borderRadius: 6 }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } }
            });

            // 2. Weekly Area Chart (Using the same data for Area breakdown)
            new Chart(document.getElementById('chartWeeklyArea'), {
                type: 'bar',
                data: { labels: w.map(x => x.Area), datasets: [{ data: w.map(x => x["Weekly Qty"]), backgroundColor: '#4ade80', borderRadius: 6 }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } }
            });

            // 3. Weekly Trend Line
            new Chart(document.getElementById('chartTrend'), {
                type: 'line',
                data: { labels: w.map(x => "WK" + x["Week No"]), datasets: [{ data: w.map(x => x["Weekly Qty"]), borderColor: '#22d3ee', fill: true, backgroundColor: 'rgba(34, 211, 238, 0.1)', tension: 0.4 }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } }
            });

            // 4 & 5. Tasks Systems
            const dailyDone = setupTasks('listDaily', 'pieDaily', 'percDaily', data.dailyTask, '#22d3ee');
            const weeklyDone = setupTasks('listWeekly', 'pieWeekly', 'percWeekly', data.weeklyTask, '#4ade80');
            
            const totalTasks = (dailyDone + weeklyDone) / 2;
            document.getElementById('task-total-perc').innerText = totalTasks.toFixed(0) + "%";
            document.getElementById('task-bar').style.width = totalTasks + "%";
        }

        function setupTasks(listId, pieId, percId, tasks, color) {
            const list = document.getElementById(listId);
            const done = tasks.filter(t => t.Status.toLowerCase().includes('complete')).length;
            const perc = ((done / tasks.length) * 100).toFixed(0);
            
            document.getElementById(percId).innerText = perc + "%";
            list.innerHTML = tasks.map(t => {
                const isD = t.Status.toLowerCase().includes('complete');
                return `<div class="item"><span>${t.Task || t.TASK}</span><div class="status-dot" style="color:${isD?'var(--green)':'var(--rose)'}; background:currentColor;"></div></div>`;
            }).join('');

            new Chart(document.getElementById(pieId), {
                type: 'doughnut',
                data: { datasets: [{ data: [done, tasks.length - done], backgroundColor: [color, 'rgba(255,255,255,0.05)'], borderWidth: 0, cutout: '80%' }] },
                options: { responsive: true, maintainAspectRatio: false }
            });
            
            return parseFloat(perc);
        }

        init();
    </script>
</body>
</html>
