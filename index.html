/*
VCB StockTeam Dashboard – FIXED STYLING VERSION (NO TAILWIND REQUIRED)
---------------------------------------------------------------
This version uses INLINE STYLES + minimal layout CSS so it will NOT appear white
and will work even if Tailwind is NOT installed.

Reads data from: /data/dashboard.json

USAGE (GitHub / Vite / CRA):
1. Place dashboard.json in: public/data/dashboard.json
2. npm install recharts framer-motion lucide-react
3. Import and render <VCBStockTeamDashboard />
*/

import React, { useEffect, useMemo, useState } from 'react';
import {
  PieChart,
  Pie,
  Cell,
  Tooltip,
  ResponsiveContainer,
  BarChart,
  Bar,
  XAxis,
  YAxis,
  CartesianGrid,
} from 'recharts';
import { motion } from 'framer-motion';
import { RefreshCw } from 'lucide-react';

const COLORS = ['#F59E0B', '#FB923C', '#F97316', '#D97706', '#92400E'];

const styles = {
  page: {
    background: '#FFF7ED',
    minHeight: '100vh',
    padding: 24,
    fontFamily: 'Inter, system-ui, Arial, sans-serif',
    color: '#1F2937',
  },
  header: {
    marginBottom: 24,
  },
  h1: {
    fontSize: 28,
    fontWeight: 700,
  },
  sub: { color: '#6B7280', marginTop: 4 },
  grid: {
    display: 'grid',
    gridTemplateColumns: '1fr 1fr',
    gap: 24,
  },
  card: {
    background: '#FFFFFF',
    borderRadius: 16,
    padding: 16,
    boxShadow: '0 10px 20px rgba(0,0,0,0.08)',
  },
  table: {
    width: '100%',
    borderCollapse: 'collapse',
    fontSize: 14,
  },
  th: {
    textAlign: 'left',
    padding: '8px 6px',
    borderBottom: '2px solid #E5E7EB',
  },
  td: {
    padding: '6px',
    borderBottom: '1px solid #E5E7EB',
  },
  badgeDone: {
    background: '#DCFCE7',
    color: '#166534',
    padding: '2px 8px',
    borderRadius: 8,
    fontSize: 12,
  },
  badgeTodo: {
    background: '#FFEDD5',
    color: '#9A3412',
    padding: '2px 8px',
    borderRadius: 8,
    fontSize: 12,
  },
};

function num(n) {
  return n == null ? '-' : n.toLocaleString();
}

export default function VCBStockTeamDashboard() {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    fetch('/data/dashboard.json')
      .then((r) => r.json())
      .then(setData)
      .catch((e) => setError(e.message))
      .finally(() => setLoading(false));
  }, []);

  const dailyStatus = useMemo(() => {
    if (!data) return [];
    const c = {};
    data.dailyTask.forEach((t) => (c[t.Status] = (c[t.Status] || 0) + 1));
    return Object.entries(c).map(([k, v], i) => ({ name: k, value: v, color: COLORS[i % COLORS.length] }));
  }, [data]);

  const weeklyVolumes = useMemo(() => {
    if (!data) return [];
    return data.weeklyPiData
      .map((r) => ({ week: `W${r['Week No']}`, qty: r['Weekly Qty'] }))
      .sort((a, b) => a.week.localeCompare(b.week));
  }, [data]);

  if (loading) return <div style={styles.page}>Loading dashboard…</div>;
  if (error) return <div style={styles.page}>Error: {error}</div>;

  return (
    <div style={styles.page}>
      <div style={styles.header}>
        <h1 style={styles.h1}>VCB StockTeam Dashboard</h1>
        <div style={styles.sub}>Snapshot date: {data.piData?.[0]?.Date}</div>
      </div>

      <div style={styles.grid}>
        {/* AREA TABLE */}
        <div style={styles.card}>
          <h3>Area KPIs</h3>
          <table style={styles.table}>
            <thead>
              <tr>
                <th style={styles.th}>Area</th>
                <th style={styles.th}>Total</th>
                <th style={styles.th}>Counted</th>
                <th style={styles.th}>Above</th>
                <th style={styles.th}>Behind</th>
              </tr>
            </thead>
            <tbody>
              {data.piData.map((r, i) => (
                <tr key={i}>
                  <td style={styles.td}>{r.Area}</td>
                  <td style={styles.td}>{num(r['Total locations'])}</td>
                  <td style={styles.td}>{num(r.Counted)}</td>
                  <td style={styles.td}>{r['Above target']?.toFixed(1)}</td>
                  <td style={styles.td}>{r['Behind targe']?.toFixed(1)}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>

        {/* DAILY TASK PIE */}
        <div style={styles.card}>
          <h3>Daily Tasks – Status</h3>
          <ResponsiveContainer width="100%" height={260}>
            <PieChart>
              <Pie data={dailyStatus} dataKey="value" nameKey="name" outerRadius={90}>
                {dailyStatus.map((e, i) => (
                  <Cell key={i} fill={e.color} />
                ))}
              </Pie>
              <Tooltip />
            </PieChart>
          </ResponsiveContainer>
        </div>

        {/* WEEKLY VOLUMES */}
        <div style={styles.card}>
          <h3>Weekly Volumes</h3>
          <ResponsiveContainer width="100%" height={260}>
            <BarChart data={weeklyVolumes}>
              <CartesianGrid strokeDasharray="3 3" />
              <XAxis dataKey="week" />
              <YAxis />
              <Tooltip />
              <Bar dataKey="qty" fill="#F59E0B" />
            </BarChart>
          </ResponsiveContainer>
        </div>

        {/* TASK LIST */}
        <div style={styles.card}>
          <h3>Daily Tasks</h3>
          {data.dailyTask.map((t, i) => (
            <div key={i} style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 6 }}>
              <span>{t.Task}</span>
              <span style={t.Status === 'Completed' ? styles.badgeDone : styles.badgeTodo}>{t.Status}</span>
            </div>
          ))}
        </div>
      </div>

      <div style={{ marginTop: 24, fontSize: 12, color: '#6B7280' }}>
        Data source: /data/dashboard.json
      </div>
    </div>
  );
}
