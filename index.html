<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VCB Stock Team Dashboard</title>
    <link rel="icon" href="data:,">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #FF6B6B 0%, #FFE66D 25%, #4ECDC4 50%, #95E1D3 100%);
            color: #fff;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            animation: fadeInDown 0.8s ease-out;
        }

        .header h1 {
            font-size: 3em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 15px;
        }

        .datetime-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .datetime-box {
            background: rgba(255,255,255,0.2);
            padding: 15px 30px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.2em;
            font-weight: bold;
            animation: pulse 2s ease-in-out infinite;
        }

        .hourglass {
            font-size: 1.5em;
            animation: flip 3s ease-in-out infinite;
            display: inline-block;
        }

        @keyframes flip {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(180deg); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: rgba(255,255,255,0.15);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(15px);
            border: 2px solid rgba(255,255,255,0.3);
            box-shadow: 0 8px 32px rgba(0,0,0,0.15);
            animation: fadeInUp 0.8s ease-out;
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.2);
        }

        .card h2 {
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid rgba(255,255,255,0.4);
            padding-bottom: 10px;
        }

        .progress-container {
            position: relative;
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .circular-progress {
            position: relative;
            width: 180px;
            height: 180px;
        }

        .circular-progress svg {
            transform: rotate(-90deg);
        }

        .circular-progress circle {
            fill: none;
            stroke-width: 15;
            stroke-linecap: round;
        }

        .circle-bg {
            stroke: rgba(255,255,255,0.2);
        }

        .circle-progress {
            stroke: #FFD93D;
            stroke-dasharray: 565;
            stroke-dashoffset: 565;
            animation: progress 2s ease-out forwards;
        }

        @keyframes progress {
            to {
                stroke-dashoffset: calc(565 - (565 * var(--progress)) / 100);
            }
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .progress-number {
            font-size: 2.5em;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .progress-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        #canvas3d {
            width: 100%;
            height: 400px;
            border-radius: 10px;
            cursor: move;
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        .donut-container {
            position: relative;
            height: 350px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .task-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .task-item {
            background: rgba(255,255,255,0.1);
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s ease;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .task-item:hover {
            background: rgba(255,255,255,0.2);
            transform: translateX(5px);
        }

        .status-badge {
            padding: 6px 14px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: bold;
            white-space: nowrap;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .status-completed {
            background: linear-gradient(135deg, #6BCF7F, #4ECDC4);
        }

        .status-not-started {
            background: linear-gradient(135deg, #FF6B6B, #FF8E53);
        }

        .area-stats {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 12px;
            margin-top: 15px;
        }

        .area-box {
            background: linear-gradient(135deg, rgba(255,255,255,0.2), rgba(255,255,255,0.1));
            padding: 18px;
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s ease;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .area-box:hover {
            background: linear-gradient(135deg, rgba(255,255,255,0.3), rgba(255,255,255,0.2));
            transform: scale(1.08);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .area-name {
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 0.95em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }

        .area-qty {
            font-size: 2em;
            font-weight: bold;
            color: #FFD93D;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .task-list::-webkit-scrollbar {
            width: 10px;
        }

        .task-list::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }

        .task-list::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #FF6B6B, #4ECDC4);
            border-radius: 10px;
        }

        .summary-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .stat-box {
            text-align: center;
            flex: 1;
            min-width: 150px;
        }

        .stat-value {
            font-size: 2.2em;
            font-weight: bold;
            color: #FFD93D;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-top: 5px;
        }

        .wide-card {
            grid-column: span 2;
        }

        @media (max-width: 768px) {
            .wide-card {
                grid-column: span 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üì¶ VCB STOCK TEAM</h1>
            <div class="datetime-container">
                <div class="datetime-box">
                    üìÖ <span id="dateDisplay">Loading...</span>
                </div>
                <div class="datetime-box">
                    <span class="hourglass">‚è≥</span>
                    <span id="timeDisplay">Loading...</span>
                </div>
            </div>
        </div>

        <div class="grid">
            <!-- Progress Card -->
            <div class="card">
                <h2>üéØ Daily Progress</h2>
                <div class="progress-container">
                    <div class="circular-progress">
                        <svg width="180" height="180">
                            <circle class="circle-bg" cx="90" cy="90" r="85"></circle>
                            <circle class="circle-progress" cx="90" cy="90" r="85" id="progressCircle"></circle>
                        </svg>
                        <div class="progress-text">
                            <div class="progress-number" id="progressPercent">0%</div>
                            <div class="progress-label" id="progressCount">0 / 0</div>
                        </div>
                    </div>
                </div>
                <div class="summary-stats">
                    <div class="stat-box">
                        <div class="stat-value" id="totalCount">0</div>
                        <div class="stat-label">Total Counted</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="targetValue">0</div>
                        <div class="stat-label">Daily Target</div>
                    </div>
                </div>
            </div>

            <!-- Daily Tasks Donut -->
            <div class="card">
                <h2>üìä Daily Tasks Progress</h2>
                <div class="donut-container">
                    <canvas id="dailyTasksDonut"></canvas>
                </div>
            </div>

            <!-- Weekly Tasks Donut -->
            <div class="card">
                <h2>üìà Weekly Tasks Progress</h2>
                <div class="donut-container">
                    <canvas id="weeklyTasksDonut"></canvas>
                </div>
            </div>

            <!-- 3D Chart -->
            <div class="card wide-card">
                <h2>üó∫Ô∏è Quantities by Area - 3D Visualization</h2>
                <div id="canvas3d"></div>
            </div>
        </div>

        <div class="grid">
            <!-- Area Stats -->
            <div class="card">
                <h2>üìä Area Statistics</h2>
                <div class="area-stats" id="areaStats"></div>
            </div>

            <!-- Weekly History -->
            <div class="card">
                <h2>üìà Weekly History</h2>
                <div class="chart-container">
                    <canvas id="weeklyChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Tasks -->
        <div class="card">
            <h2>‚úÖ Daily Tasks (<span id="taskStats">0/0</span>)</h2>
            <div class="task-list" id="taskList"></div>
        </div>
    </div>

    <script>
        // Prevent favicon and other resource errors
        window.addEventListener('error', function(e) {
            if (e.target.tagName === 'LINK' || e.target.tagName === 'SCRIPT') {
                e.preventDefault();
            }
        }, true);

        let data;

        // Update time every second
        function updateTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('en-GB', { 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit' 
            });
            document.getElementById('timeDisplay').textContent = timeStr;
        }

        setInterval(updateTime, 1000);
        updateTime();

        // Fetch data from data.json
        async function loadData() {
            try {
                const response = await fetch('data.json');
                data = await response.json();
                initDashboard();
            } catch (error) {
                console.error('Error loading data:', error);
                data = {"metadata":{"dailyTarget":1193,"date":"2025-12-24"},"dailyCounting":{"total":917,"byArea":[{"area":"MPR","qty":127},{"area":"PB1","qty":38},{"area":"PB2","qty":15},{"area":"PBSRES","qty":45},{"area":"MP","qty":221},{"area":"MIX","qty":136},{"area":"MS","qty":61},{"area":"MSX","qty":249},{"area":"FM","qty":20},{"area":"HP","qty":5}]},"dailyTasks":[{"task":"ADJUSTMENTS (Returns)","status":"Not started"},{"task":"ADJUSTMENTS (Standard)","status":"Not started"},{"task":"Aged stock report 7AM","status":"Completed"}],"weeklyHistory":[{"week":"W27","total":5103},{"week":"W28","total":6457},{"week":"W29","total":7494},{"week":"W30","total":6901},{"week":"W31","total":5447},{"week":"W32","total":4524},{"week":"W33","total":2068}]};
                initDashboard();
            }
        }

        function initDashboard() {
            displayDate();
            displayProgress();
            displayAreaStats();
            displayTasks();
            displayWeeklyChart();
            displayDailyTasksDonut();
            displayWeeklyTasksDonut();
            init3DChart();
        }

        function displayDate() {
            document.getElementById('dateDisplay').textContent = data.metadata.date;
        }

        function displayProgress() {
            const total = data.dailyCounting.total;
            const target = data.metadata.dailyTarget;
            const percent = Math.min(Math.round((total / target) * 100), 100);

            document.getElementById('progressPercent').textContent = `${percent}%`;
            document.getElementById('progressCount').textContent = `${total} / ${target}`;
            document.getElementById('totalCount').textContent = total;
            document.getElementById('targetValue').textContent = target;

            const circle = document.getElementById('progressCircle');
            circle.style.setProperty('--progress', percent);
            
            if (percent >= 100) {
                circle.style.stroke = '#6BCF7F';
            } else if (percent >= 75) {
                circle.style.stroke = '#FFD93D';
            } else {
                circle.style.stroke = '#FF8E53';
            }
        }

        function displayAreaStats() {
            const container = document.getElementById('areaStats');
            container.innerHTML = '';

            const filteredAreas = data.dailyCounting.byArea
                .filter(area => area.area !== 'PB3' && area.area !== 'PB4')
                .sort((a, b) => b.qty - a.qty);

            filteredAreas.forEach(area => {
                const box = document.createElement('div');
                box.className = 'area-box';
                box.innerHTML = `
                    <div class="area-name">${area.area}</div>
                    <div class="area-qty">${area.qty}</div>
                `;
                container.appendChild(box);
            });
        }

        function displayTasks() {
            const container = document.getElementById('taskList');
            container.innerHTML = '';

            const completed = data.dailyTasks.filter(t => t.status === 'Completed').length;
            const total = data.dailyTasks.length;
            document.getElementById('taskStats').textContent = `${completed}/${total} Completed`;

            data.dailyTasks.forEach(task => {
                const item = document.createElement('div');
                item.className = 'task-item';
                
                const statusClass = task.status === 'Completed' ? 'status-completed' : 'status-not-started';
                const statusIcon = task.status === 'Completed' ? '‚úì' : '‚óã';
                
                item.innerHTML = `
                    <span class="status-badge ${statusClass}">${statusIcon}</span>
                    <span>${task.task}</span>
                `;
                container.appendChild(item);
            });
        }

        function displayDailyTasksDonut() {
            const completed = data.dailyTasks.filter(t => t.status === 'Completed').length;
            const notStarted = data.dailyTasks.length - completed;

            const ctx = document.getElementById('dailyTasksDonut').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Completed', 'Not Started'],
                    datasets: [{
                        data: [completed, notStarted],
                        backgroundColor: [
                            'rgba(107, 207, 127, 0.8)',
                            'rgba(255, 142, 83, 0.8)'
                        ],
                        borderColor: [
                            'rgba(107, 207, 127, 1)',
                            'rgba(255, 142, 83, 1)'
                        ],
                        borderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#fff',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                },
                                padding: 20
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function displayWeeklyTasksDonut() {
            const validWeeks = data.weeklyHistory.filter(w => w.week !== 'W' && w.total > 0);
            const totalWeeks = 7;
            const completedWeeks = validWeeks.length;
            const remainingWeeks = totalWeeks - completedWeeks;

            const ctx = document.getElementById('weeklyTasksDonut').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Completed Weeks', 'Remaining Weeks'],
                    datasets: [{
                        data: [completedWeeks, remainingWeeks],
                        backgroundColor: [
                            'rgba(78, 205, 196, 0.8)',
                            'rgba(255, 230, 109, 0.8)'
                        ],
                        borderColor: [
                            'rgba(78, 205, 196, 1)',
                            'rgba(255, 230, 109, 1)'
                        ],
                        borderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#fff',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                },
                                padding: 20
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed;
                                    const total = totalWeeks;
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function displayWeeklyChart() {
            const validWeeks = data.weeklyHistory.filter(w => w.week !== 'W' && w.total > 0);
            
            const ctx = document.getElementById('weeklyChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: validWeeks.map(w => w.week),
                    datasets: [{
                        label: 'Weekly Total',
                        data: validWeeks.map(w => w.total),
                        borderColor: '#FFD93D',
                        backgroundColor: 'rgba(255, 217, 61, 0.2)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        pointBackgroundColor: '#FFD93D',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.2)'
                            },
                            ticks: {
                                color: '#fff',
                                font: {
                                    weight: 'bold'
                                }
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.2)'
                            },
                            ticks: {
                                color: '#fff',
                                font: {
                                    weight: 'bold'
                                }
                            }
                        }
                    }
                }
            });
        }

        function init3DChart() {
            const container = document.getElementById('canvas3d');
            const scene = new THREE.Scene();
            scene.background = new THREE.Color(0x2a2a3e);

            const camera = new THREE.PerspectiveCamera(75, container.offsetWidth / 400, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(container.offsetWidth, 400);
            container.appendChild(renderer.domElement);

            const areas = data.dailyCounting.byArea
                .filter(a => a.qty > 0 && a.area !== 'PB3' && a.area !== 'PB4');
            const maxQty = Math.max(...areas.map(a => a.qty));
            const barWidth = 0.8;
            const spacing = 1.5;

            const warmColors = [
                0xFF6B6B, 0xFF8E53, 0xFFD93D, 0x6BCF7F, 
                0x4ECDC4, 0x95E1D3, 0xFFA07A, 0xFFB347
            ];

            areas.forEach((area, index) => {
                const height = (area.qty / maxQty) * 5 + 0.5;
                const geometry = new THREE.BoxGeometry(barWidth, height, barWidth);
                
                const color = new THREE.Color(warmColors[index % warmColors.length]);
                const material = new THREE.MeshPhongMaterial({ 
                    color: color,
                    shininess: 100,
                    specular: 0x555555
                });
                
                const cube = new THREE.Mesh(geometry, material);
                cube.position.x = (index - areas.length / 2) * spacing;
                cube.position.y = height / 2;
                
                scene.add(cube);

                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                canvas.width = 256;
                canvas.height = 128;
                context.fillStyle = 'white';
                context.font = 'bold 40px Arial';
                context.textAlign = 'center';
                context.fillText(area.area, 128, 50);
                context.fillText(area.qty, 128, 100);

                const texture = new THREE.CanvasTexture(canvas);
                const spriteMaterial = new THREE.SpriteMaterial({ map: texture });
                const sprite = new THREE.Sprite(spriteMaterial);
                sprite.position.x = cube.position.x;
                sprite.position.y = height + 1;
                sprite.scale.set(2, 1, 1);
                scene.add(sprite);
            });

            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(5, 10, 5);
            scene.add(directionalLight);

            camera.position.set(0, 5, 12);
            camera.lookAt(0, 2, 0);

            let mouseX = 0;
            let targetRotation = 0;

            container.addEventListener('mousemove', (e) => {
                mouseX = (e.clientX / container.offsetWidth) * 2 - 1;
                targetRotation = mouseX * Math.PI * 0.3;
            });

            function animate() {
                requestAnimationFrame(animate);
                scene.rotation.y += (targetRotation - scene.rotation.y) * 0.05;
                renderer.render(scene, camera);
            }
            animate();

            window.addEventListener('resize', () => {
                camera.aspect = container.offsetWidth / 400;
                camera.updateProjectionMatrix();
                renderer.setSize(container.offsetWidth, 400);
            });
        }

        loadData();
    </script>
</body>
</html>
