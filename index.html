<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>STOCK TEAM | VCB AURA 3D</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;600;800&display=swap" rel="stylesheet">
    <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
    <script type="importmap">
    { "imports": { "three": "https://unpkg.com/three@0.158.0/build/three.module.js" } }
    </script>
    <style>
        :root {
            --bg: #05070a; --card: rgba(15, 20, 28, 0.85);
            --gold: #f6d365; --rose: #ff758c; --mint: #00f2ff;
            --text: #ffffff; --border: rgba(255,255,255,0.1);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; }
        
        #main-canvas { position: fixed; top: 0; left: 0; z-index: -1; }

        .app { display: grid; grid-template-rows: 90px 1fr; gap: 20px; padding: 20px; height: 100vh; position: relative; z-index: 1; }

        /* HEADER */
        .header {
            display: grid; grid-template-columns: 1fr 2fr 1fr; align-items: center;
            background: var(--card); border-radius: 30px; border: 1px solid var(--border);
            padding: 0 40px; backdrop-filter: blur(20px); box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        .brand { font-weight: 800; font-size: 1.6rem; letter-spacing: -1px; }
        .clock-center { display: flex; align-items: center; justify-content: center; gap: 30px; }
        #time { font-size: 2.5rem; font-weight: 800; letter-spacing: 4px; color: #fff; }

        /* GRID */
        .main-content { display: grid; grid-template-columns: 1fr 380px; gap: 20px; min-height: 0; }
        .visuals { display: grid; grid-template-rows: 1fr 1fr; gap: 20px; }
        
        /* 3D PANELS */
        .panel { 
            background: var(--card); border-radius: 35px; border: 1px solid var(--border);
            padding: 25px; display: flex; flex-direction: column; position: relative;
        }
        .panel-title { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 3px; color: var(--gold); margin-bottom: 10px; }

        /* CHART CONTAINERS */
        .charts-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; flex: 1; }
        .chart-3d-box { position: relative; width: 100%; height: 100%; }

        /* TASK FEED */
        .task-column { display: flex; flex-direction: column; height: 100%; overflow: hidden; }
        .task-list { overflow-y: auto; padding-right: 10px; margin-top: 10px; }
        .task-list::-webkit-scrollbar { width: 3px; }
        .task-list::-webkit-scrollbar-thumb { background: var(--gold); border-radius: 10px; }

        .task-card {
            background: rgba(255,255,255,0.03); padding: 15px 20px; border-radius: 20px;
            margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center;
            border: 1px solid transparent; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .task-card:hover { transform: scale(1.02); background: rgba(255,255,255,0.07); }
        .task-card.ready { border-left: 4px solid var(--mint); background: rgba(0, 242, 255, 0.05); }

        .status { font-size: 0.6rem; font-weight: 800; padding: 6px 14px; border-radius: 50px; text-transform: uppercase; }
        .s-ready { background: var(--mint); color: #000; box-shadow: 0 0 15px rgba(0,242,255,0.4); }
        .s-wait { background: rgba(255,255,255,0.1); color: #888; }

    </style>
</head>
<body>

<canvas id="main-canvas"></canvas>

<div class="app">
    <header class="header">
        <div class="brand">STOCK TEAM <span style="color:var(--gold)">| VCB</span></div>
        <div class="clock-center">
            <div id="hourglass-3d" style="width: 80px; height: 80px;"></div>
            <div id="time">00:00:00</div>
        </div>
        <div style="text-align: right">
            <button onclick="document.documentElement.requestFullscreen()" class="status s-wait" style="cursor:pointer">Fullscreen Mode</button>
        </div>
    </header>

    <div class="main-content">
        <div class="visuals">
            <div class="panel">
                <div class="panel-title">Mission Critical Progress</div>
                <div class="charts-row">
                    <div class="chart-3d-box" id="daily-3d"></div>
                    <div class="chart-3d-box" id="weekly-3d"></div>
                    <div class="chart-3d-box" id="target-3d"></div>
                </div>
            </div>
            <div class="panel">
                <div class="panel-title">Area Performance Spectrum</div>
                <div id="spectrum-3d" style="flex:1"></div>
            </div>
        </div>

        <div class="panel">
            <div class="task-column">
                <div class="panel-title">Operation Feed</div>
                <div class="task-list" id="globalTasks"></div>
            </div>
        </div>
    </div>
</div>

<script type="module">
    import * as THREE from 'three';

    // -- DATA SETUP --
    const tasks = [
        {n: "Aged stock report 7AM", s: "Completed", type: "Daily"},
        {n: "Returns Audit", s: "Pending", type: "Daily"},
        {n: "PI First Count", s: "Completed", type: "Daily"},
        {n: "Monthly Shrinkage", s: "Completed", type: "Weekly"},
        {n: "Strategic ORM", s: "Pending", type: "Weekly"},
        {n: "Team Briefing", s: "Pending", type: "Daily"},
        {n: "SLA Master Sync", s: "Pending", type: "Weekly"}
    ];

    // -- THREE.JS ENGINE --
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('main-canvas'), antialias: true, alpha: true });
    renderer.setSize(window.innerWidth, window.innerHeight);

    // -- BACKGROUND PARTICLES --
    const particlesGeo = new THREE.BufferGeometry();
    const particlesCount = 1500;
    const posArray = new Float32Array(particlesCount * 3);
    for(let i=0; i < particlesCount * 3; i++) { posArray[i] = (Math.random() - 0.5) * 10; }
    particlesGeo.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
    const particlesMaterial = new THREE.PointsMaterial({ size: 0.005, color: 0xf6d365, transparent: true, opacity: 0.4 });
    const particlesMesh = new THREE.Points(particlesGeo, particlesMaterial);
    scene.add(particlesMesh);

    // -- HOURGLASS 3D --
    const hContainer = document.getElementById('hourglass-3d');
    const hScene = new THREE.Scene();
    const hCamera = new THREE.PerspectiveCamera(45, 1, 0.1, 100);
    const hRenderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    hRenderer.setSize(80, 80);
    hContainer.appendChild(hRenderer.domElement);

    const glassGeo = new THREE.ConeGeometry(2, 3, 4);
    const glassMat = new THREE.MeshPhongMaterial({ color: 0xf6d365, wireframe: true, transparent: true, opacity: 0.3 });
    const topGlass = new THREE.Mesh(glassGeo, glassMat);
    const bottomGlass = new THREE.Mesh(glassGeo, glassMat);
    bottomGlass.rotation.x = Math.PI;
    bottomGlass.position.y = -3;
    const hGroup = new THREE.Group();
    hGroup.add(topGlass, bottomGlass);
    hScene.add(hGroup);
    hScene.add(new THREE.AmbientLight(0xffffff, 1));
    hCamera.position.z = 10;

    // -- REUSABLE DONUT 3D --
    function create3DDonut(id, color) {
        const cont = document.getElementById(id);
        const s = new THREE.Scene();
        const c = new THREE.PerspectiveCamera(45, cont.clientWidth / cont.clientHeight, 0.1, 100);
        const r = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        r.setSize(cont.clientWidth, cont.clientHeight);
        cont.appendChild(r.domElement);

        const torus = new THREE.Mesh(
            new THREE.TorusGeometry(5, 1.5, 16, 100),
            new THREE.MeshStandardMaterial({ color: color, roughness: 0.3, metalness: 0.8 })
        );
        s.add(torus);
        const l = new THREE.PointLight(0xffffff, 10); l.position.set(5,5,5); s.add(l);
        s.add(new THREE.AmbientLight(0xffffff, 0.5));
        c.position.z = 15;

        function a() { 
            requestAnimationFrame(a); 
            torus.rotation.y += 0.02; 
            torus.rotation.x += 0.01;
            r.render(s, c); 
        }
        a();
    }

    // -- CLOCK & RENDER --
    setInterval(() => {
        document.getElementById('time').innerText = new Date().toLocaleTimeString('en-GB', {hour12:false});
    }, 1000);

    function renderUI() {
        const list = document.getElementById('globalTasks');
        list.innerHTML = tasks.map(t => `
            <div class="task-card ${t.s === 'Completed' ? 'ready' : ''}">
                <div>
                    <div style="font-size:0.85rem; font-weight:600">${t.n}</div>
                    <div style="font-size:0.6rem; color:#666">${t.type}</div>
                </div>
                <span class="status ${t.s === 'Completed' ? 's-ready' : 's-wait'}">${t.s === 'Completed' ? 'Ready' : 'Pending'}</span>
            </div>
        `).join('');
    }

    // -- ANIMATION LOOP --
    function animate() {
        requestAnimationFrame(animate);
        particlesMesh.rotation.y += 0.001;
        hGroup.rotation.y += 0.04;
        renderer.render(scene, camera);
        hRenderer.render(hScene, hCamera);
    }

    window.onload = () => {
        renderUI();
        animate();
        create3DDonut('daily-3d', 0xff758c);
        create3DDonut('weekly-3d', 0xf6d365);
        create3DDonut('target-3d', 0x00f2ff);
    };

    // Resize
    window.addEventListener('resize', () => {
        renderer.setSize(window.innerWidth, window.innerHeight);
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
    });
</script>
</body>
</html>
