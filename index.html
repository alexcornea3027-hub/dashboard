<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Team VCB - Professional Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <style>
        :root {
            --bg-deep: #050b18;
            --card-glass: rgba(15, 23, 42, 0.8);
            --accent-blue: #0ea5e9;
            --accent-cyan: #22d3ee;
            --accent-green: #10b981;
            --accent-red: #ef4444;
            --text-main: #f8fafc;
            --text-dim: #94a3b8;
            --neon-glow: 0 0 15px rgba(14, 165, 233, 0.4);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
            background: radial-gradient(circle at top right, #0f172a, #050b18);
            color: var(--text-main);
            height: 100vh;
            overflow: hidden; /* STRICT NO SCROLL */
            display: flex;
            flex-direction: column;
            padding: 12px;
        }

        /* --- HEADER --- */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 10vh;
            background: var(--card-glass);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 0 30px;
            margin-bottom: 15px;
            border: 1px solid rgba(255,255,255,0.08);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .brand h1 {
            font-size: 1.8rem;
            font-weight: 800;
            background: linear-gradient(to right, #fff, var(--accent-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -1px;
        }

        .vcb-badge {
            font-size: 0.7rem;
            background: var(--accent-blue);
            color: white;
            padding: 2px 8px;
            border-radius: 20px;
            margin-left: 10px;
            vertical-align: middle;
            box-shadow: var(--neon-glow);
        }

        .clock-vcb { text-align: center; }
        #time { font-size: 2.2rem; font-weight: 900; letter-spacing: 2px; color: var(--text-main); line-height: 1; }
        #date { font-size: 0.8rem; color: var(--accent-cyan); text-transform: uppercase; margin-top: 4px; }

        /* --- GRID SYSTEM --- */
        .vcb-grid {
            display: grid;
            grid-template-columns: 1fr 1.2fr 1fr;
            grid-template-rows: 52vh 1fr;
            gap: 15px;
            flex: 1;
        }

        .vcb-card {
            background: var(--card-glass);
            backdrop-filter: blur(5px);
            border-radius: 20px;
            padding: 15px;
            border: 1px solid rgba(255,255,255,0.05);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
        }

        .vcb-card:hover { border-color: rgba(14, 165, 233, 0.3); }

        .card-label {
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--text-dim);
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
        }

        /* --- CHART PLACEMENT --- */
        .chart-box { flex: 1; position: relative; min-height: 0; }

        /* 3D FLOATING EFFECT FOR DONUT */
        .donut-3d-scene {
            perspective: 1200px;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .donut-3d-object {
            width: 85%;
            height: 85%;
            transform: rotateX(15deg);
            animation: float3D 5s ease-in-out infinite;
            filter: drop-shadow(0 25px 35px rgba(0,0,0,0.8));
        }
        @keyframes float3D {
            0%, 100% { transform: rotateX(15deg) translateY(0); }
            50% { transform: rotateX(20deg) translateY(-15px); }
        }

        .center-kpi {
            position: absolute;
            text-align: center;
            pointer-events: none;
        }
        .percent-val { font-size: 3rem; font-weight: 900; color: #fff; line-height: 1; }
        .percent-lbl { font-size: 0.8rem; color: var(--accent-cyan); letter-spacing: 2px; }

        /* --- TABLES --- */
        .vcb-table-container {
            flex: 1;
            overflow-y: auto;
            margin-top: 5px;
        }
        .vcb-table-container::-webkit-scrollbar { width: 4px; }
        .vcb-table-container::-webkit-scrollbar-thumb { background: var(--accent-blue); border-radius: 10px; }

        table { width: 100%; border-collapse: separate; border-spacing: 0 4px; }
        th { font-size: 0.7rem; color: var(--text-dim); text-align: left; padding: 8px; sticky: top; background: var(--bg-deep); }
        td { font-size: 0.8rem; padding: 10px 8px; background: rgba(255,255,255,0.03); }
        td:first-child { border-radius: 8px 0 0 8px; font-weight: 600; }
        td:last-child { border-radius: 0 8px 8px 0; text-align: right; }

        .badge { padding: 3px 8px; border-radius: 6px; font-size: 0.65rem; font-weight: 700; text-transform: uppercase; }
        .badge-done { background: rgba(16, 185, 129, 0.2); color: var(--accent-green); }
        .badge-wait { background: rgba(239, 68, 68, 0.2); color: var(--accent-red); }

        /* --- STATS PANEL --- */
        .kpi-summary {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        .kpi-tile {
            background: rgba(255,255,255,0.03);
            padding: 12px;
            border-radius: 15px;
            text-align: center;
        }
        .kpi-tile .val { font-size: 1.4rem; font-weight: 800; display: block; }
        .kpi-tile .tag { font-size: 0.6rem; color: var(--text-dim); text-transform: uppercase; }

        #errorBanner {
            position: fixed; top: 0; left: 0; width: 100%; background: var(--accent-red);
            color: white; padding: 4px; text-align: center; z-index: 1000; font-size: 0.7rem; display: none;
        }

    </style>
</head>
<body>

    <div id="errorBanner">CONNECTION ERROR: Using Internal Fallback Data</div>

    <header>
        <div class="brand">
            <h1>STOCK TEAM <span style="color:var(--accent-cyan)">VCB</span> <span class="vcb-badge">PRO v2.0</span></h1>
        </div>

        <div class="clock-vcb">
            <div id="time">00:00:00</div>
            <div id="date">LOADING SYSTEM...</div>
        </div>

        <div style="display: flex; gap: 25px;">
            <div class="kpi-tile" style="min-width: 120px; background: none; border-right: 1px solid rgba(255,255,255,0.1); border-radius: 0;">
                <span class="val" id="topDailyCount" style="color: var(--accent-cyan);">0</span>
                <span class="tag">Daily Counted</span>
            </div>
            <div class="kpi-tile" style="min-width: 120px; background: none;">
                <span class="val" id="topVsTarget">0</span>
                <span class="tag">Vs Target (1193)</span>
            </div>
        </div>
    </header>

    <main class="vcb-grid">
        
        <div class="vcb-card">
            <div class="card-label">
                <span>Daily Activity</span>
                <span style="color:var(--accent-cyan)">By Area</span>
            </div>
            <div class="chart-box">
                <canvas id="chartDaily"></canvas>
            </div>
        </div>

        <div class="vcb-card">
            <div class="card-label">
                <span>Cycle Completion</span>
                <span id="cycleInfo">Total Cycle</span>
            </div>
            <div class="chart-box donut-3d-scene">
                <div class="donut-3d-object">
                    <canvas id="chartCycle"></canvas>
                    <div class="center-kpi">
                        <div class="percent-val" id="mainPercent">0%</div>
                        <div class="percent-lbl">COMPLETE</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="vcb-card">
            <div class="card-label">
                <span>Weekly Progress</span>
                <span style="color:var(--accent-green)">By Week No</span>
            </div>
            <div class="chart-box">
                <canvas id="chartWeekly"></canvas>
            </div>
        </div>

        <div class="vcb-card" style="grid-column: 1 / 2;">
            <div class="card-label">Daily Check-list</div>
            <div class="vcb-table-container">
                <table id="tableDaily"></table>
            </div>
        </div>

        <div class="vcb-card" style="grid-column: 2 / 3;">
            <div class="card-label">Performance Analysis</div>
            <div class="kpi-summary">
                <div class="kpi-tile">
                    <span class="val" id="statAvg" style="color:var(--accent-blue)">0</span>
                    <span class="tag">Avg Per Area</span>
                </div>
                <div class="kpi-tile">
                    <span class="val" id="statEff" style="color:var(--accent-green)">0%</span>
                    <span class="tag">Efficiency Rate</span>
                </div>
                <div class="kpi-tile">
                    <span class="val" id="statRem" style="color:var(--accent-red)">0</span>
                    <span class="tag">Remaining Locs</span>
                </div>
                <div class="kpi-tile">
                    <span class="val" id="statPrio">HIGH</span>
                    <span class="tag">System Priority</span>
                </div>
            </div>
        </div>

        <div class="vcb-card" style="grid-column: 3 / 4;">
            <div class="card-label">Weekly Deliverables</div>
            <div class="vcb-table-container">
                <table id="tableWeekly"></table>
            </div>
        </div>

    </main>

    <script>
        // CONFIG
        const TARGET = 1193;

        // CLOCK
        function updateClock() {
            const now = new Date();
            document.getElementById('time').textContent = now.toLocaleTimeString('en-GB', { hour12: false });
            document.getElementById('date').textContent = now.toLocaleDateString('en-GB', { weekday: 'long', day: 'numeric', month: 'long' });
        }
        setInterval(updateClock, 1000);
        updateClock();

        // DATA LOADING
        async function init() {
            try {
                const res = await fetch('data/dashboard.json');
                if(!res.ok) throw new Error();
                const data = await res.json();
                renderDashboard(data);
            } catch (e) {
                document.getElementById('errorBanner').style.display = 'block';
                // Use the data you provided as fallback
                renderDashboard(getFallbackData());
            }
        }

        function renderDashboard(data) {
            // 1. DATA PREP
            const pi = data.piData || [];
            const wPi = data.weeklyPiData || [];

            // Daily Logic
            const dailyLabels = wPi.map(d => d.Area);
            const dailyValues = wPi.map(d => Number(d["Daily Qty"]) || 0);
            const dailySum = dailyValues.reduce((a,b) => a+b, 0);

            // Weekly Logic (CRITICAL: Sort by Week No)
            const weeklySorted = [...wPi].sort((a,b) => a["Week No"] - b["Week No"]);
            const weeklyLabels = weeklySorted.map(d => `Wk ${d["Week No"]}`);
            const weeklyValues = weeklySorted.map(d => Number(d["Weekly Qty"]) || 0);

            // Cycle Logic
            let tLoc = 0, tCnt = 0;
            pi.forEach(r => { 
                tLoc += Number(r["Total locations"]) || 0; 
                tCnt += Number(r.Counted) || 0; 
            });
            const cyclePerc = tLoc > 0 ? ((tCnt / tLoc) * 100).toFixed(1) : 0;

            // 2. HEADER UPDATES
            document.getElementById('topDailyCount').textContent = dailySum.toLocaleString();
            const diff = dailySum - TARGET;
            const diffEl = document.getElementById('topVsTarget');
            diffEl.textContent = (diff > 0 ? "+" : "") + diff;
            diffEl.style.color = diff >= 0 ? 'var(--accent-green)' : 'var(--accent-red)';

            // 3. STATS PANEL
            document.getElementById('mainPercent').textContent = cyclePerc + "%";
            document.getElementById('statAvg').textContent = (dailySum / (dailyLabels.length || 1)).toFixed(0);
            document.getElementById('statEff').textContent = (cyclePerc * 1.1).toFixed(0) + "%"; // Mock calc
            document.getElementById('statRem').textContent = (tLoc - tCnt).toLocaleString();

            // 4. CHARTS
            createDailyChart(dailyLabels, dailyValues);
            createWeeklyChart(weeklyLabels, weeklyValues);
            createCycleChart(tCnt, tLoc - tCnt);

            // 5. TABLES
            fillTable('tableDaily', data.dailyTask);
            fillTable('tableWeekly', data.weeklyTask);
        }

        function createDailyChart(labels, values) {
            new Chart(document.getElementById('chartDaily'), {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        data: values,
                        backgroundColor: values.map(v => v > 100 ? '#0ea5e9' : '#1e293b'),
                        borderRadius: 6,
                        borderWidth: 1,
                        borderColor: 'rgba(255,255,255,0.1)'
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: {display: false}, datalabels: { color: '#fff', anchor: 'end', align: 'top' } },
                    scales: {
                        y: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#64748b' } },
                        x: { grid: { display: false }, ticks: { color: '#64748b', font: { size: 9 } } }
                    }
                },
                plugins: [ChartDataLabels]
            });
        }

        function createWeeklyChart(labels, values) {
            const ctx = document.getElementById('chartWeekly').getContext('2d');
            const grad = ctx.createLinearGradient(0, 0, 0, 300);
            grad.addColorStop(0, 'rgba(34, 211, 238, 0.3)');
            grad.addColorStop(1, 'rgba(34, 211, 238, 0)');

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Qty',
                        data: values,
                        borderColor: '#22d3ee',
                        borderWidth: 3,
                        pointBackgroundColor: '#22d3ee',
                        fill: true,
                        backgroundColor: grad,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: {display: false} },
                    scales: {
                        y: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#64748b' } },
                        x: { grid: { display: false }, ticks: { color: '#64748b' } }
                    }
                }
            });
        }

        function createCycleChart(done, rem) {
            new Chart(document.getElementById('chartCycle'), {
                type: 'doughnut',
                data: {
                    labels: ['Completed', 'Pending'],
                    datasets: [{
                        data: [done, rem],
                        backgroundColor: ['#0ea5e9', 'rgba(255,255,255,0.05)'],
                        hoverOffset: 4,
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    cutout: '80%',
                    plugins: { legend: { display: false } }
                }
            });
        }

        function fillTable(id, tasks) {
            const container = document.getElementById(id);
            if(!tasks) return;
            container.innerHTML = tasks.slice(0, 15).map(t => {
                const isDone = (t.Status || "").toLowerCase().includes('complete');
                return `<tr>
                    <td>${t.Task || t.TASK}</td>
                    <td><span class="badge ${isDone ? 'badge-done' : 'badge-wait'}">${t.Status}</span></td>
                </tr>`;
            }).join('');
        }

        function getFallbackData() {
            // This is just a container to ensure code doesn't crash if fetch fails
            return {
                "piData": [{"Area": "MPR", "Total locations": 14622, "Counted": 3936}],
                "dailyTask": [{"Task": "Aged stock report 7AM", "Status": "Completed"}],
                "weeklyTask": [{"Task": "MLC on FM", "Status": "Not started"}],
                "weeklyPiData": [{"Area": "MPR", "Daily Qty": 127, "Week No": 27, "Weekly Qty": 5103}]
            };
        }

        init();
    </script>
</body>
</html>
