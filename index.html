<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Royal Horizon | Floating Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;500;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-deep: #0f172a;
            --bg-gradient: linear-gradient(135deg, #020617 0%, #1e1b4b 60%, #312e81 100%);
            --card-bg: rgba(30, 41, 59, 0.4);
            --border: rgba(255, 255, 255, 0.1);
            
            --gold: #f59e0b;
            --coral: #f43f5e;
            --blue: #3b82f6;
            --neon-blue: #06b6d4;
            --text: #ffffff;
            --text-mute: #94a3b8;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Manrope', sans-serif;
            background: var(--bg-gradient);
            color: var(--text);
            height: 100vh;
            overflow: hidden;
            padding: 15px;
            display: flex; flex-direction: column;
        }

        /* --- HEADER CU CEAS CENTRAL --- */
        header {
            height: 10vh;
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 20px; margin-bottom: 10px;
        }
        
        .logo-area h1 { font-size: 1.5rem; font-weight: 800; letter-spacing: 1px; }
        .logo-area span { color: var(--gold); text-transform: uppercase; font-size: 0.75rem; }

        .clock-widget {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            padding: 5px 30px; border-radius: 50px;
            display: flex; align-items: center; gap: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 15px rgba(245, 158, 11, 0.2);
        }
        .time { font-size: 2.2rem; font-weight: 800; }
        .date { text-align: right; font-size: 0.8rem; line-height: 1.2; color: var(--text-mute); }
        .date strong { color: var(--gold); font-size: 1rem; display: block; }

        /* --- LAYOUT PRINCIPAL --- */
        main {
            flex: 1;
            display: grid;
            grid-template-rows: 22vh 30vh 1fr; /* 3 Randuri: Donuturi / Grafice / Liste */
            gap: 15px;
            min-height: 0;
        }

        /* ROW 1: FLOATING DONUTS */
        .donut-row {
            display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;
        }

        .float-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 20px;
            position: relative;
            backdrop-filter: blur(12px);
            display: flex; align-items: center; justify-content: space-between;
            padding: 10px 20px;
            animation: float 6s ease-in-out infinite;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        /* Efect de plutire decalat */
        .float-card:nth-child(1) { animation-delay: 0s; }
        .float-card:nth-child(2) { animation-delay: 2s; }
        .float-card:nth-child(3) { animation-delay: 4s; }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-8px); }
            100% { transform: translateY(0px); }
        }

        .d-info h3 { font-size: 0.9rem; color: var(--text-mute); text-transform: uppercase; }
        .d-info h2 { font-size: 2rem; font-weight: 800; }
        .d-chart-box { height: 100%; width: 100px; position: relative; }
        .d-percent { position: absolute; top:50%; left:50%; transform:translate(-50%, -50%); font-weight:800; font-size:0.9rem;}

        /* ROW 2: MAIN CHARTS */
        .charts-row {
            display: grid; grid-template-columns: 1.5fr 1fr; gap: 15px;
        }
        .chart-card {
            background: var(--card-bg); border: 1px solid var(--border);
            border-radius: 16px; padding: 15px; display: flex; flex-direction: column;
        }
        .c-header { display: flex; justify-content: space-between; margin-bottom: 10px; font-weight: 700; font-size: 0.9rem; }
        .canvas-container { flex: 1; position: relative; min-height: 0; }

        /* ROW 3: BIG TASK LISTS */
        .lists-row {
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px;
            min-height: 0; overflow: hidden;
        }
        .list-card {
            background: var(--card-bg); border: 1px solid var(--border);
            border-radius: 16px; padding: 15px; display: flex; flex-direction: column;
            height: 100%; overflow: hidden;
        }
        
        .scroll-area {
            flex: 1; overflow-y: auto; padding-right: 5px; margin-top: 10px;
        }
        .scroll-area::-webkit-scrollbar { width: 5px; }
        .scroll-area::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 10px; }

        .task-item {
            display: flex; justify-content: space-between; align-items: center;
            background: rgba(0,0,0,0.2); padding: 12px; margin-bottom: 8px; border-radius: 8px;
            border-left: 3px solid transparent; transition: 0.2s;
        }
        .task-item:hover { background: rgba(255,255,255,0.1); }
        
        .daily-task { border-left-color: var(--coral); }
        .weekly-task { border-left-color: var(--blue); }

        .t-title { font-size: 0.85rem; font-weight: 500; }
        .t-status { font-size: 0.7rem; font-weight: 800; text-transform: uppercase; }
        .s-done { color: #10b981; }
        .s-wait { color: var(--text-mute); }

    </style>
</head>
<body>

    <header>
        <div class="logo-area">
            <span>Executive Dashboard</span>
            <h1>STOCK CONTROL</h1>
        </div>
        <div class="clock-widget">
            <div class="date" id="date-display">TUE<br><strong>23 DEC</strong></div>
            <div class="time" id="time-display">00:00</div>
        </div>
        <div style="width: 150px; text-align: right;">
            <span style="font-size:0.7rem; color: #94a3b8;">SYSTEM STATUS</span><br>
            <span style="color: #10b981; font-weight: 700;">‚óè ONLINE</span>
        </div>
    </header>

    <main>
        <div class="donut-row">
            <div class="float-card">
                <div class="d-info">
                    <h3>Total Counted</h3>
                    <h2 id="total-counted" style="color: var(--gold);">0</h2>
                    <span style="font-size: 0.7rem; color: #94a3b8;">Target: 1193 / Day</span>
                </div>
                <div class="d-chart-box">
                    <canvas id="d1"></canvas>
                    <div class="d-percent" id="p1">0%</div>
                </div>
            </div>

            <div class="float-card">
                <div class="d-info">
                    <h3>Daily Tasks</h3>
                    <h2 id="daily-fraction" style="color: var(--coral);">0/0</h2>
                    <span style="font-size: 0.7rem; color: #94a3b8;">Operational</span>
                </div>
                <div class="d-chart-box">
                    <canvas id="d2"></canvas>
                    <div class="d-percent" id="p2">0%</div>
                </div>
            </div>

            <div class="float-card">
                <div class="d-info">
                    <h3>Weekly Tasks</h3>
                    <h2 id="weekly-fraction" style="color: var(--blue);">0/0</h2>
                    <span style="font-size: 0.7rem; color: #94a3b8;">Strategic</span>
                </div>
                <div class="d-chart-box">
                    <canvas id="d3"></canvas>
                    <div class="d-percent" id="p3">0%</div>
                </div>
            </div>
        </div>

        <div class="charts-row">
            <div class="chart-card">
                <div class="c-header"><span style="color: var(--coral)">‚ñÆ Daily Output by Area</span> <span>LIVE PI DATA</span></div>
                <div class="canvas-container"><canvas id="barChart"></canvas></div>
            </div>
            <div class="chart-card">
                <div class="c-header"><span style="color: var(--blue)">üìà Weekly Trend</span> <span>HISTORY</span></div>
                <div class="canvas-container"><canvas id="lineChart"></canvas></div>
            </div>
        </div>

        <div class="lists-row">
            <div class="list-card">
                <div class="c-header" style="border-bottom: 1px solid var(--border); padding-bottom:10px;">
                    üìù DAILY TASK LIST
                    <span style="background: rgba(244,63,94,0.2); color: var(--coral); padding: 2px 8px; border-radius: 4px; font-size: 0.7rem;">PRIORITY</span>
                </div>
                <div class="scroll-area" id="daily-feed"></div>
            </div>

            <div class="list-card">
                <div class="c-header" style="border-bottom: 1px solid var(--border); padding-bottom:10px;">
                    üìÖ WEEKLY TASK LIST
                    <span style="background: rgba(59,130,246,0.2); color: var(--blue); padding: 2px 8px; border-radius: 4px; font-size: 0.7rem;">SCHEDULE</span>
                </div>
                <div class="scroll-area" id="weekly-feed"></div>
            </div>
        </div>
    </main>

    <script>
        // --- DATA INPUT (Strictly from your JSON) ---
        const db = {
          "piData": [
            { "Area": "MPR", "Counted": 3936 },
            { "Area": "PB1", "Counted": 1189 },
            { "Area": "PB2", "Counted": 484 },
            { "Area": "PB3", "Counted": 0 },
            { "Area": "PB4", "Counted": 0 },
            { "Area": "PBSRES", "Counted": 1374 },
            { "Area": "MP", "Counted": 7409 },
            { "Area": "MIX", "Counted": 8941 },
            { "Area": "MS", "Counted": 5902 },
            { "Area": "MSX", "Counted": 7984 },
            { "Area": "FM", "Counted": 620 },
            { "Area": "HP", "Counted": 155 }
          ],
          "dailyTask": [
            { "Task": "ADJUSTMENTS (Returns)", "Status": "Not started" },
            { "Task": "ADJUSTMENTS (Standard)", "Status": "Not started" },
            { "Task": "Aged stock report 7AM", "Status": "Completed" },
            { "Task": "Aged stock report 3PM", "Status": "Not started" },
            { "Task": "Blackwells", "Status": "Not started" },
            { "Task": "AGED STOCK REPORT 6 AM", "Status": "Not started" },
            { "Task": "EMPTY BIN CHECKS", "Status": "Not started" },
            { "Task": "Internet returns", "Status": "Not started" },
            { "Task": "Inventory Status (DATA STUDIO)", "Status": "Not started" },
            { "Task": "LOCATIONS IN ERROR", "Status": "Not started" },
            { "Task": "PI 1st count", "Status": "Not started" },
            { "Task": "PI 2nd count", "Status": "Not started" },
            { "Task": "PI assign", "Status": "Not started" },
            { "Task": "PI Investigation", "Status": "Not started" },
            { "Task": "SLA update", "Status": "Not started" }
          ],
          "weeklyTask": [
            { "Task": "(Weekly) SLA", "Status": "Not started" },
            { "Task": "(Weekly) SIS report", "Status": "Not started" },
            { "Task": "(Weekly) Shrinkage", "Status": "Not started" },
            { "Task": "(Weekly) ORM", "Status": "Not started" },
            { "Task": "(Tuesday) RP split pack", "Status": "Not started" },
            { "Task": "(Thursday) RP split pack", "Status": "Not started" },
            { "Task": "(once a month) Shrinkage for Period", "Status": "Completed" },
            { "Task": "(Weekly) Returns locations checks", "Status": "Not started" }
          ],
          "weeklyPiData": [
            { "Week No": 27, "Weekly Qty": 5103 },
            { "Week No": 28, "Weekly Qty": 6457 },
            { "Week No": 29, "Weekly Qty": 7494 },
            { "Week No": 30, "Weekly Qty": 6901 },
            { "Week No": 31, "Weekly Qty": 5447 },
            { "Week No": 32, "Weekly Qty": 4524 },
            { "Week No": 33, "Weekly Qty": 2068 },
            { "Week No": 34, "Weekly Qty": 0 }
          ]
        };

        // --- CLOCK ---
        setInterval(() => {
            const n = new Date();
            const days = ['SUN','MON','TUE','WED','THU','FRI','SAT'];
            const months = ['JAN','FEB','MAR','APR','MAY','JUN','JUL','AUG','SEP','OCT','NOV','DEC'];
            document.getElementById('time-display').innerText = n.toLocaleTimeString('en-GB', {hour:'2-digit', minute:'2-digit'});
            document.getElementById('date-display').innerHTML = `${days[n.getDay()]}<br><strong>${n.getDate()} ${months[n.getMonth()]}</strong>`;
        }, 1000);

        // --- CHART & DATA LOGIC ---
        const commonOptions = {
            responsive: true, maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: { x: { display: false }, y: { display: false } },
            cutout: '75%'
        };

        // 1. DOUGHNUTS LOGIC
        function drawDonut(id, percentId, current, total, color) {
            const p = total > 0 ? Math.round((current / total) * 100) : 0;
            document.getElementById(percentId).innerText = p + "%";
            
            new Chart(document.getElementById(id), {
                type: 'doughnut',
                data: {
                    labels: ["Done", "Left"],
                    datasets: [{
                        data: [current, total - current],
                        backgroundColor: [color, 'rgba(255,255,255,0.05)'],
                        borderWidth: 0
                    }]
                },
                options: commonOptions
            });
        }

        // Calculate Totals
        const totalCounted = db.piData.reduce((acc, c) => acc + c.Counted, 0);
        const dailyTotalTasks = db.dailyTask.length;
        const dailyDoneTasks = db.dailyTask.filter(t => t.Status === "Completed").length;
        const weeklyTotalTasks = db.weeklyTask.length;
        const weeklyDoneTasks = db.weeklyTask.filter(t => t.Status === "Completed").length;

        // Populate Top Cards
        document.getElementById('total-counted').innerText = totalCounted.toLocaleString();
        document.getElementById('daily-fraction').innerText = `${dailyDoneTasks}/${dailyTotalTasks}`;
        document.getElementById('weekly-fraction').innerText = `${weeklyDoneTasks}/${weeklyTotalTasks}`;

        // Render 3 Floating Donuts
        drawDonut('d1', 'p1', totalCounted, 50000, '#f59e0b'); // Target 50k arbitrar pentru % vizual sau pune 0
        drawDonut('d2', 'p2', dailyDoneTasks, dailyTotalTasks, '#f43f5e');
        drawDonut('d3', 'p3', weeklyDoneTasks, weeklyTotalTasks, '#3b82f6');

        // 2. MAIN BAR CHART (Strictly piData)
        const ctxBar = document.getElementById('barChart').getContext('2d');
        const gradBar = ctxBar.createLinearGradient(0,0,0,300);
        gradBar.addColorStop(0, '#f43f5e'); gradBar.addColorStop(1, '#f59e0b'); // Coral to Gold

        new Chart(ctxBar, {
            type: 'bar',
            data: {
                labels: db.piData.map(d => d.Area),
                datasets: [{
                    data: db.piData.map(d => d.Counted),
                    backgroundColor: gradBar,
                    borderRadius: 5,
                    barThickness: 25
                }]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: { ticks: { color: '#94a3b8', font:{size:10} }, grid:{display:false} },
                    y: { display: false }
                }
            }
        });

        // 3. WEEKLY LINE CHART (Strictly weeklyPiData)
        const ctxLine = document.getElementById('lineChart').getContext('2d');
        const gradLine = ctxLine.createLinearGradient(0,0,0,300);
        gradLine.addColorStop(0, 'rgba(59, 130, 246, 0.5)'); gradLine.addColorStop(1, 'rgba(59, 130, 246, 0)');

        new Chart(ctxLine, {
            type: 'line',
            data: {
                labels: db.weeklyPiData.map(d => "W" + d["Week No"]),
                datasets: [{
                    data: db.weeklyPiData.map(d => d["Weekly Qty"]),
                    borderColor: '#3b82f6',
                    backgroundColor: gradLine,
                    fill: true, tension: 0.4, pointRadius: 4, pointBackgroundColor: '#fff'
                }]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: { ticks: { color: '#94a3b8' }, grid:{display:false} },
                    y: { display: false }
                }
            }
        });

        // 4. GENERATE TASK LISTS
        function renderList(list, containerId, typeClass) {
            const container = document.getElementById(containerId);
            list.forEach(item => {
                const isDone = item.Status === "Completed";
                const statusHtml = isDone 
                    ? `<span class="t-status s-done">‚úî COMPLETED</span>` 
                    : `<span class="t-status s-wait">‚óã ${item.Status.toUpperCase()}</span>`;
                
                container.innerHTML += `
                    <div class="task-item ${typeClass}">
                        <span class="t-title">${item.Task}</span>
                        ${statusHtml}
                    </div>
                `;
            });
        }

        renderList(db.dailyTask, 'daily-feed', 'daily-task');
        renderList(db.weeklyTask, 'weekly-feed', 'weekly-task');

    </script>
</body>
</html>
