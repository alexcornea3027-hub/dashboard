<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Team VCB | Command Center</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <style>
        :root {
            --bg: #020617;
            --glass: rgba(15, 23, 42, 0.7);
            --neon-blue: #0ea5e9;
            --neon-cyan: #22d3ee;
            --neon-purple: #8b5cf6;
            --neon-green: #10b981;
            --neon-red: #ef4444;
            --text: #f8fafc;
            --border: rgba(255, 255, 255, 0.1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: radial-gradient(circle at center, #0f172a 0%, #020617 100%);
            color: var(--text);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            padding: 15px;
        }

        /* --- HEADER --- */
        header {
            height: 12vh;
            background: var(--glass);
            backdrop-filter: blur(15px);
            border: 1px solid var(--border);
            border-radius: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 40px;
            margin-bottom: 15px;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
        }

        .logo-area h1 {
            font-size: 1.8rem;
            letter-spacing: 2px;
            text-transform: uppercase;
            background: linear-gradient(90deg, #fff, var(--neon-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 10px rgba(34, 211, 238, 0.3));
        }

        .clock-box { text-align: center; }
        #clock-time { font-size: 2.5rem; font-weight: 800; color: #fff; line-height: 1; }
        #clock-date { color: var(--neon-cyan); font-size: 0.9rem; text-transform: uppercase; margin-top: 5px; }

        /* --- MAIN LAYOUT --- */
        .dashboard-container {
            flex: 1;
            display: grid;
            grid-template-columns: 1fr 1.5fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 15px;
        }

        .card {
            background: var(--glass);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 15px;
            position: relative;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .card-title {
            font-size: 0.75rem;
            font-weight: 800;
            color: var(--neon-cyan);
            text-transform: uppercase;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-title::before { content: ''; width: 4px; height: 15px; background: var(--neon-cyan); border-radius: 2px; }

        .chart-wrap { flex: 1; position: relative; min-height: 0; }

        /* --- SPECIFIC STYLES --- */
        .center-main { grid-row: span 2; display: flex; flex-direction: column; }

        .gauge-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            transform: translateY(-20px);
        }

        .gauge-text {
            position: absolute;
            bottom: 20%;
            text-align: center;
        }
        .gauge-val { font-size: 4.5rem; font-weight: 900; color: #fff; text-shadow: 0 0 20px rgba(14,165,233,0.5); }
        .gauge-label { font-size: 1rem; color: var(--neon-cyan); letter-spacing: 3px; }

        .stat-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            padding-top: 10px;
        }

        .stat-pill {
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--border);
            padding: 15px;
            border-radius: 15px;
            text-align: center;
        }
        .stat-pill .v { font-size: 1.2rem; font-weight: 700; display: block; }
        .stat-pill .t { font-size: 0.6rem; color: var(--neon-cyan); text-transform: uppercase; }

        #error-overlay {
            position: fixed; top: 0; left:0; width: 100%; padding: 5px; 
            background: var(--neon-red); text-align: center; z-index: 1000; font-weight: bold; display: none;
        }

    </style>
</head>
<body>

    <div id="error-overlay">OFFLINE MODE: Loading Fallback Data</div>

    <header>
        <div class="logo-area">
            <h1>Stock Team <span style="font-weight: 300;">VCB</span></h1>
        </div>
        <div class="clock-box">
            <div id="clock-time">00:00:00</div>
            <div id="clock-date">22 December 2025</div>
        </div>
        <div class="stat-grid" style="padding: 0;">
            <div class="stat-pill" style="border:none; background:none;">
                <span class="v" id="h-total" style="color:var(--neon-cyan)">0</span>
                <span class="t">Total Today</span>
            </div>
            <div class="stat-pill" style="border:none; background:none;">
                <span class="v" id="h-target">0</span>
                <span class="t">Vs Target</span>
            </div>
        </div>
    </header>

    <div class="dashboard-container">
        
        <div class="card">
            <div class="card-title">Daily Activity (Area)</div>
            <div class="chart-wrap">
                <canvas id="chart-daily"></canvas>
            </div>
        </div>

        <div class="card">
            <div class="card-title">Daily Task Completion</div>
            <div class="chart-wrap">
                <canvas id="chart-tasks-daily"></canvas>
            </div>
        </div>

        <div class="card center-main">
            <div class="card-title">Cycle Completion Performance</div>
            <div class="gauge-container">
                <canvas id="chart-gauge"></canvas>
                <div class="gauge-text">
                    <div class="gauge-val" id="perc-val">0%</div>
                    <div class="gauge-label">TOTAL CYCLE</div>
                </div>
            </div>
            <div class="stat-grid">
                <div class="stat-pill">
                    <span class="v" id="s-counted" style="color:var(--neon-green)">0</span>
                    <span class="t">Counted</span>
                </div>
                <div class="stat-pill">
                    <span class="v" id="s-rem" style="color:var(--neon-red)">0</span>
                    <span class="t">Remaining</span>
                </div>
                <div class="stat-pill">
                    <span class="v" id="s-eff" style="color:var(--neon-purple)">0%</span>
                    <span class="t">Efficiency</span>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-title">Weekly Progress (By Week No)</div>
            <div class="chart-wrap">
                <canvas id="chart-weekly"></canvas>
            </div>
        </div>

        <div class="card">
            <div class="card-title">Weekly Task Completion</div>
            <div class="chart-wrap">
                <canvas id="chart-tasks-weekly"></canvas>
            </div>
        </div>

    </div>

    <script>
        const DAILY_TARGET = 1193;

        // --- CLOCK ---
        function runClock() {
            const now = new Date();
            document.getElementById('clock-time').textContent = now.toLocaleTimeString('en-GB', { hour12: false });
            document.getElementById('clock-date').textContent = now.toLocaleDateString('en-GB', { weekday: 'long', day: 'numeric', month: 'long' });
        }
        setInterval(runClock, 1000);

        // --- DATA ENGINE ---
        async function startApp() {
            try {
                const res = await fetch('data/dashboard.json');
                if(!res.ok) throw new Error();
                const data = await res.json();
                renderAll(data);
            } catch (e) {
                document.getElementById('error-overlay').style.display = 'block';
                renderAll(getDemoData());
            }
        }

        function renderAll(data) {
            const pi = data.piData || [];
            const wPi = data.weeklyPiData || [];
            const dTasks = data.dailyTask || [];
            const wTasks = data.weeklyTask || [];

            // 1. Calculations
            const dailySum = wPi.reduce((a,b) => a + (Number(b["Daily Qty"]) || 0), 0);
            let tLoc = 0, tCnt = 0;
            pi.forEach(r => { 
                tLoc += Number(r["Total locations"]) || 0; 
                tCnt += Number(r.Counted) || 0; 
            });
            const cyclePerc = tLoc > 0 ? ((tCnt/tLoc)*100).toFixed(1) : 0;

            // 2. Header & Stats Update
            document.getElementById('h-total').textContent = dailySum.toLocaleString();
            const diff = dailySum - DAILY_TARGET;
            const hTarget = document.getElementById('h-target');
            hTarget.textContent = (diff > 0 ? "+" : "") + diff;
            hTarget.style.color = diff >= 0 ? 'var(--neon-green)' : 'var(--neon-red)';
            
            document.getElementById('perc-val').textContent = cyclePerc + "%";
            document.getElementById('s-counted').textContent = tCnt.toLocaleString();
            document.getElementById('s-rem').textContent = (tLoc - tCnt).toLocaleString();
            document.getElementById('s-eff').textContent = (cyclePerc * 0.95).toFixed(0) + "%";

            // 3. Render Charts
            initDailyChart(wPi);
            initWeeklyChart(wPi);
            initGauge(tCnt, tLoc - tCnt);
            initTaskChart('chart-tasks-daily', dTasks, 'Daily');
            initTaskChart('chart-tasks-weekly', wTasks, 'Weekly');
        }

        // --- CHART CONSTRUCTORS ---

        function initDailyChart(wPi) {
            new Chart(document.getElementById('chart-daily'), {
                type: 'bar',
                data: {
                    labels: wPi.map(d => d.Area),
                    datasets: [{
                        data: wPi.map(d => d["Daily Qty"]),
                        backgroundColor: '#0ea5e9',
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: {display: false} },
                    scales: {
                        y: { beginAtZero: true, ticks: { color: '#64748b' }, grid: { color: 'rgba(255,255,255,0.05)' } },
                        x: { ticks: { color: '#64748b' }, grid: { display: false } }
                    }
                }
            });
        }

        function initWeeklyChart(wPi) {
            const sorted = [...wPi].sort((a,b) => a["Week No"] - b["Week No"]);
            new Chart(document.getElementById('chart-weekly'), {
                type: 'line',
                data: {
                    labels: sorted.map(d => "Wk " + d["Week No"]),
                    datasets: [{
                        data: sorted.map(d => d["Weekly Qty"]),
                        borderColor: '#22d3ee',
                        tension: 0.4,
                        fill: true,
                        backgroundColor: 'rgba(34, 211, 238, 0.1)'
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: {display: false} },
                    scales: {
                        y: { beginAtZero: true, ticks: { color: '#64748b' }, grid: { color: 'rgba(255,255,255,0.05)' } },
                        x: { ticks: { color: '#64748b' }, grid: { display: false } }
                    }
                }
            });
        }

        function initGauge(done, rem) {
            new Chart(document.getElementById('chart-gauge'), {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [done, rem],
                        backgroundColor: ['#0ea5e9', 'rgba(255,255,255,0.05)'],
                        borderWidth: 0,
                        circumference: 240,
                        rotation: 240,
                        cutout: '85%',
                        borderRadius: 20
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { tooltip: {enabled: false} }
                }
            });
        }

        function initTaskChart(canvasId, tasks, type) {
            const completed = tasks.filter(t => t.Status.toLowerCase().includes('complete')).length;
            const pending = tasks.length - completed;

            new Chart(document.getElementById(canvasId), {
                type: 'polarArea',
                data: {
                    labels: ['Completed', 'Pending'],
                    datasets: [{
                        data: [completed, pending],
                        backgroundColor: [type === 'Daily' ? 'rgba(16, 185, 129, 0.5)' : 'rgba(139, 92, 246, 0.5)', 'rgba(255,255,255,0.05)'],
                        borderColor: [type === 'Daily' ? '#10b981' : '#8b5cf6', 'transparent'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    scales: { r: { display: false } },
                    plugins: { 
                        legend: { position: 'right', labels: { color: '#fff', font: {size: 10} } }
                    }
                }
            });
        }

        function getDemoData() {
            return {
                "piData": [{"Area": "MPR", "Total locations": 14622, "Counted": 3936}],
                "dailyTask": [{"Task": "A1", "Status": "Completed"}, {"Task": "A2", "Status": "Not started"}],
                "weeklyTask": [{"Task": "W1", "Status": "Not started"}],
                "weeklyPiData": [{"Area": "MPR", "Daily Qty": 127, "Week No": 27, "Weekly Qty": 5103}]
            };
        }

        startApp();
        runClock();
    </script>
</body>
</html>
