<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Stock Team VCB — Dashboard</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<style>
body{margin:0;font-family:Poppins,system-ui;background:#0b1020;color:#eaf6ff}
header{padding:16px 20px;border-bottom:1px solid rgba(255,255,255,.08)}
h1{margin:0;font-size:20px}
small{color:#9aa4b2}
main{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px;padding:16px}
.panel{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:14px}
ul{list-style:none;padding:0;margin:0}
li{padding:6px 0;border-bottom:1px solid rgba(255,255,255,.05)}
.done{color:#7dd3fc}
.todo{color:#ff7a7a}
canvas{width:100%!important;height:260px!important}
button{padding:8px 12px;border-radius:8px;border:0;cursor:pointer;font-weight:700}
</style>
</head>

<body>

<header>
  <h1>Stock Team VCB</h1>
  <small id="meta">loading…</small>
</header>

<main>
  <div class="panel">
    <h3>Daily Tasks</h3>
    <ul id="dailyList"></ul>
  </div>

  <div class="panel">
    <h3>Weekly Tasks</h3>
    <ul id="weeklyList"></ul>
  </div>

  <div class="panel">
    <h3>Progress</h3>
    <canvas id="dailyChart"></canvas>
    <canvas id="weeklyChart"></canvas>
  </div>
</main>

<div style="padding:16px">
  <button onclick="refresh()">Refresh</button>
</div>

<script>
let dailyChart, weeklyChart;

function refresh(){
  fetch('./data/dashboard.json?_=' + Date.now())
    .then(r => {
      if(!r.ok) throw new Error('fetch failed');
      return r.json();
    })
    .then(data => render(data))
    .catch(err => {
      console.warn('Using demo data', err);
      render(demoData);
    });
}

function render(data){
  document.getElementById('meta').innerText =
    'Updated: ' + (data.meta?.today || '');

  fillList('dailyList', data.daily?.list || []);
  fillList('weeklyList', data.weekly?.list || []);

  drawCharts(data);
}

function fillList(id, items){
  const el = document.getElementById(id);
  el.innerHTML = '';
  items.forEach(t => {
    const li = document.createElement('li');
    li.className = t.done ? 'done' : 'todo';
    li.innerText = (t.done ? '✔ ' : '⏳ ') + t.task;
    el.appendChild(li);
  });
}

function drawCharts(data){
  if(dailyChart) dailyChart.destroy();
  if(weeklyChart) weeklyChart.destroy();

  dailyChart = new Chart(
    document.getElementById('dailyChart'),
    {
      type:'doughnut',
      data:{
        labels:['Done','Remaining'],
        datasets:[{
          data:[
            data.daily.done,
            data.daily.scheduled - data.daily.done
          ],
          backgroundColor:['#7dd3fc','#1e293b']
        }]
      },
      options:{plugins:{legend:{display:false}}}
    }
  );

  weeklyChart = new Chart(
    document.getElementById('weeklyChart'),
    {
      type:'doughnut',
      data:{
        labels:['Done','Remaining'],
        datasets:[{
          data:[
            data.weekly.done,
            data.weekly.scheduled - data.weekly.done
          ],
          backgroundColor:['#8b5cf6','#1e293b']
        }]
      },
      options:{plugins:{legend:{display:false}}}
    }
  );
}

const demoData = {
  daily:{
    scheduled:5,
    done:2,
    list:[
      {task:'Daily report',done:true},
      {task:'Inventory check',done:false}
    ]
  },
  weekly:{
    scheduled:10,
    done:4,
    list:[
      {task:'Weekly SLA',done:true},
      {task:'Shrinkage review',done:false}
    ]
  },
  meta:{today:new Date().toLocaleDateString()}
};

refresh();
</script>

</body>
</html>
