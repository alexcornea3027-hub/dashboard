<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VCB Stock Dashboard | Pro Edition</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');

        :root {
            --bg: #030712;
            --card: rgba(17, 24, 39, 0.75);
            --cyan: #06b6d4;
            --emerald: #10b981;
            --rose: #f43f5e;
            --text-p: #f8fafc;
            --text-s: #94a3b8;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: radial-gradient(circle at top right, #111827, #020617);
            color: var(--text-p);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            padding: 10px;
        }

        /* UI ELEMENTS */
        #fs-btn {
            position: fixed; bottom: 15px; right: 15px; z-index: 100;
            background: var(--card); border: 1px solid var(--cyan);
            color: var(--cyan); width: 35px; height: 35px; border-radius: 50%;
            cursor: pointer; font-weight: 800; transition: 0.3s;
            display: flex; align-items: center; justify-content: center;
        }
        #fs-btn:hover { background: var(--cyan); color: white; scale: 1.1; }

        header {
            height: 10vh; display: grid; grid-template-columns: 1fr 2fr 1fr;
            gap: 10px; margin-bottom: 10px;
        }

        .panel {
            background: var(--card); backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 15px; padding: 5px 15px;
            display: flex; flex-direction: column; justify-content: center;
        }

        .kpi-grid { display: grid; grid-template-columns: repeat(3, 1fr); text-align: center; }
        .kpi-box h2 { font-size: 1.4rem; font-weight: 800; color: var(--cyan); }
        .kpi-box span { font-size: 0.55rem; text-transform: uppercase; color: var(--text-s); }

        /* GRID SYSTEM */
        main {
            flex: 1;
            display: grid;
            grid-template-columns: 1.2fr 1fr 1fr;
            grid-template-rows: 47% 47%; /* Prevents cutting off the bottom */
            gap: 10px;
            min-height: 0;
        }

        .card {
            background: var(--card); border-radius: 18px;
            border: 1px solid rgba(255,255,255,0.05);
            padding: 10px; display: flex; flex-direction: column;
            position: relative; overflow: hidden;
            box-shadow: 0 10px 20px -5px rgba(0,0,0,0.5);
        }

        .card-title {
            font-size: 0.6rem; font-weight: 800; text-transform: uppercase;
            color: var(--cyan); margin-bottom: 5px;
            display: flex; justify-content: space-between;
        }

        .chart-box { flex: 1; position: relative; min-height: 0; width: 100%; }

        .donut-val {
            position: absolute; top: 55%; left: 50%;
            transform: translate(-50%, -50%); text-align: center;
        }
        .donut-val h3 { font-size: 1.1rem; font-weight: 800; }
        .donut-val p { font-size: 0.5rem; color: var(--text-s); }

        /* SCROLLER */
        .scroller { overflow-y: auto; }
        .scroller::-webkit-scrollbar { width: 3px; }
        .scroller::-webkit-scrollbar-thumb { background: var(--cyan); }
        .task {
            background: rgba(255,255,255,0.02); padding: 5px 8px;
            border-radius: 6px; margin-bottom: 3px; font-size: 0.65rem;
            display: flex; justify-content: space-between;
        }
        .tag-done { color: var(--emerald); font-weight: 800; }
    </style>
</head>
<body>

    <button id="fs-btn" onclick="toggleFS()">â›¶</button>

    <header>
        <div class="panel">
            <h2 id="clock" style="font-size: 1.2rem;">00:00:00</h2>
            <p id="date" style="font-size: 0.65rem; color: var(--text-s);"></p>
        </div>
        <div class="panel">
            <div class="kpi-grid">
                <div class="kpi-box"><span>Day Counts</span><h2 id="k-day">0</h2></div>
                <div class="kpi-box"><span>Weekly Avg</span><h2 id="k-avg">0</h2></div>
                <div class="kpi-box"><span>vs Target</span><h2 id="k-delta">0</h2></div>
            </div>
        </div>
        <div class="panel" style="align-items: flex-end;">
            <span style="font-size: 0.55rem; color: var(--text-s);">OVERALL COMPLIANCE</span>
            <h2 id="perf" style="color: var(--emerald); font-size: 1.2rem;">0%</h2>
        </div>
    </header>

    <main>
        <div class="card">
            <div class="card-title">Daily Area Output <span>Live</span></div>
            <div class="chart-box"><canvas id="dailyBar"></canvas></div>
        </div>

        <div class="card">
            <div class="card-title">Daily Tasks <span>Compliance</span></div>
            <div class="chart-box">
                <canvas id="dailyDonut"></canvas>
                <div class="donut-val"><h3 id="d-perc">0%</h3><p>DONE</p></div>
            </div>
        </div>

        <div class="card">
            <div class="card-title">Weekly Tasks <span>Compliance</span></div>
            <div class="chart-box">
                <canvas id="weeklyDonut"></canvas>
                <div class="donut-val"><h3 id="w-perc">0%</h3><p>DONE</p></div>
            </div>
        </div>

        <div class="card">
            <div class="card-title" id="current-week-lbl">Current Week Distribution <span>Area</span></div>
            <div class="chart-box"><canvas id="weekDistBar"></canvas></div>
        </div>

        <div class="card">
            <div class="card-title">Weekly Progression <span>Counts per Week</span></div>
            <div class="chart-box"><canvas id="progBar"></canvas></div>
        </div>

        <div class="card">
            <div class="card-title">Task Monitor <span>Recent</span></div>
            <div class="scroller" id="taskFeed"></div>
        </div>
    </main>

    <script>
        const rawData = {
            "tasks": [
                {"T": "Aged stock 7AM", "S": "Completed", "type": "D"},
                {"T": "ADJUSTMENTS (Returns)", "S": "Not started", "type": "D"},
                {"T": "LOCATIONS IN ERROR", "S": "Not started", "type": "D"},
                {"T": "SLA update", "S": "Not started", "type": "D"},
                {"T": "Shrinkage Period", "S": "Completed", "type": "W"},
                {"T": "(Weekly) SLA", "S": "Not started", "type": "W"},
                {"T": "(Weekly) SIS report", "S": "Not started", "type": "W"}
            ],
            "stats": [
                {"A": "MPR", "D": 127, "W": 34, "Qty": 5103},
                {"A": "PB1", "D": 38, "W": 34, "Qty": 6457},
                {"A": "PB2", "D": 15, "W": 34, "Qty": 7494},
                {"A": "MP", "D": 221, "W": 33, "Qty": 4068},
                {"A": "MIX", "D": 136, "W": 32, "Qty": 3900}
            ]
        };

        function toggleFS() {
            if (!document.fullscreenElement) document.documentElement.requestFullscreen();
            else document.exitFullscreen();
        }

        function updateTime() {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString('en-GB');
            document.getElementById('date').innerText = now.toLocaleDateString('en-GB', {weekday: 'short', day: 'numeric', month: 'short'});
        }
        setInterval(updateTime, 1000); updateTime();

        function render() {
            // Filter only latest week for "Current Week Distribution"
            const maxW = Math.max(...rawData.stats.map(x => x.W));
            const currentWeekData = rawData.stats.filter(x => x.W === maxW);
            document.getElementById('current-week-lbl').innerHTML = `Distribution <span>Week ${maxW}</span>`;

            // Charts
            new Chart(document.getElementById('dailyBar'), cfg('bar', rawData.stats.map(x=>x.A), rawData.stats.map(x=>x.D), '#06b6d4'));
            new Chart(document.getElementById('weekDistBar'), cfg('bar', currentWeekData.map(x=>x.A), currentWeekData.map(x=>x.Qty), '#10b981'));
            
            // Weekly Progression (W32, W33, W34)
            const prog = {};
            rawData.stats.forEach(s => { prog[s.W] = (prog[s.W] || 0) + s.Qty; });
            new Chart(document.getElementById('progBar'), cfg('line', Object.keys(prog).map(k=>"W"+k), Object.values(prog), '#06b6d4', true));

            // Donut Compliance
            const dP = setDonut('dailyDonut', 'd-perc', rawData.tasks.filter(t=>t.type==='D'), '#06b6d4');
            const wP = setDonut('weeklyDonut', 'w-perc', rawData.tasks.filter(t=>t.type==='W'), '#10b981');
            document.getElementById('perf').innerText = ((dP + wP) / 2).toFixed(1) + "%";

            // KPI calculation
            const dayTotal = rawData.stats.reduce((s,x)=>s+x.D, 0);
            document.getElementById('k-day').innerText = dayTotal;
            document.getElementById('k-delta').innerText = dayTotal - 1193;
            document.getElementById('k-avg').innerText = (rawData.stats.reduce((s,x)=>s+x.Qty, 0) / 4).toFixed(0);

            // Task List
            document.getElementById('taskFeed').innerHTML = rawData.tasks.map(t => `
                <div class="task"><span>${t.T}</span><span class="${t.S==='Completed'?'tag-done':''}" style="font-size:0.5rem">${t.S.toUpperCase()}</span></div>
            `).join('');
        }

        function cfg(type, labels, data, color, fill=false) {
            return {
                type: type,
                data: { labels, datasets: [{ data, backgroundColor: color, borderColor: color, fill: fill, tension: 0.4, borderRadius: 4 }] },
                options: { 
                    responsive: true, maintainAspectRatio: false, 
                    plugins: { legend: { display: false } },
                    scales: { 
                        y: { display: false }, 
                        x: { ticks: { font: { size: 7 }, color: '#64748b' }, grid: { display: false } } 
                    } 
                }
            };
        }

        function setDonut(id, txtId, tasks, color) {
            const done = tasks.filter(t => t.S === 'Completed').length;
            const p = ((done / tasks.length) * 100).toFixed(0);
            document.getElementById(txtId).innerText = p + "%";
            new Chart(document.getElementById(id), {
                type: 'doughnut',
                data: { datasets: [{ data: [done, tasks.length - done], backgroundColor: [color, 'rgba(255,255,255,0.02)'], borderWidth: 0, cutout: '80%' }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { tooltip: { enabled: false } } }
            });
            return parseFloat(p);
        }

        render();
    </script>
</body>
</html>
